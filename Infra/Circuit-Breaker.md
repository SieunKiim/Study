# 서킷브레이커란?

서킷브레이커는 분산 시스템에서 장애 전파를 방지하는 디자인패턴이다. (전기 회로의 차단기에서 따온 어원이라나 뭐라나)

위에 말한 어원처럼 문제 발생 / 감지 시 회로를 차단해서 과부하 및 장애 전파를 방지하는 것에 목적을 두고있다.

## 3가지 상태

서킷브레이커에서는 각 서비스를 상태로서 관리한다.

1. Closed (정상 상태)
모든 요청이 정상적으로 통과
실패율을 지속적으로 모니터링

2. Open (차단 상태)
임계치 이상의 실패 감지 시 활성화
모든 요청을 즉시 차단하고 빠른 실패(Fail Fast) 응답
외부 서비스에 추가 부하를 주지 않음

3. Half-Open (반개방 상태)
일정 시간 후 소수의 테스트 요청만 허용
성공하면 Closed로, 실패하면 다시 Open으로

## 상태를 통해 어떤 처리를 하는가?

1. 장애 전파 방지
주문 서비스 장애 시

    - as-is : 타임아웃으로 인한 지연 및 전체 시스템 지연 발생
    - to-be : 서킷 브레이커 동작으로 극각적인 대체 로직 수행

2. 리소스 보호 (불필요한 요청 및 로직 수행을 막을 수 있음)

    - 스레드 풀 고갈 방지
    - 불필요한 네트워크 호출 차단
    - 시스템 안정성 향상

## 서킷 브레이커는 어떤 기준으로 상태를 변경할까?

서킷브레이커는 요청들의 성공/실패 비율을 바탕으로 상태를 결졍한다.
이때 서킷브레이커의 핵심 로직이 Sliding Window 알고리즘이다.

특정 기간을 기준으로 성공과 실패에대한 비율을 즉각적으로 업데이트가 필요하기 때문이다.

>전체 기간: [성공][실패][성공][실패][실패][성공][실패] ← 현재
Sliding Window (size=5): [성공][실패][실패][성공][실패]
→ 실패율: 3/5 = 60%

